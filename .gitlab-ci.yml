variables:
  IMAGE_NAME: predict_employee
  IMAGE_TAG: latest

stages:
  - test
  - build
  - deploy

run_tests:
  stage: test
  image: python:3.10.10
  before_script:
    - pip install pytest
  script:
    - pytest training/test

build_image:
  stage: build
  image: python:3.10.10
  variables:
  before_script:
    - apt-get update
    - apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    - pip install bentoml
  script:
    - bentoml build application/src
    - bentoml containerize $IMAGE_NAME:$IMAGE_TAG --opt platform=linux/amd64
    - docker tag $IMAGE_NAME:$IMAGE_TAG pycaret1vund.azurecr.io/predict_employee
    - docker push pycaret1vund.azurecr.io/predict_employee




